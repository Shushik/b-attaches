/**
 * b-attaches script
 *
 * @version 2.0
 * @author  Shushik <silkleopard@yandex.ru>
 * @page    http://github.com/Shushik/b-attaches
 *
 * @requires jQuery 1.6+
 */
;(function(b){function h(){var a=b(this).addClass("b-attaches__input"),c=a.clone(),d=this.onclick();d||(d={});d.attaches_add||(d.attaches_add="Add file");var f=b('<div class="b-attaches"></div>'),g=b('<div class="b-attaches__example"><span class="b-attaches__text">'+d.attaches_add+'</span><span class="b-attaches__remove">\u00d7</span></div>');f.data("params",d);c.bind("change",k);f.delegate(".b-attaches__remove","click",l);g.append(c);a.replaceWith(f.append(g));i.call(f.get(0))}function k(){var a= b(this),c=a.closest(".b-attaches__button"),d=c.closest(".b-attaches"),f=b(".b-attaches__text",c),g=d.data("params"),e=a=a.val().split(/\/|\\/).pop(),h=e.length,j=e.split(".").pop();g.attaches_crop&&e.length>g.attaches_crop&&(e=e.substring(0,5)+" \u2026 "+e.substring(h-8));j&&c.addClass("b-attaches__label_type_"+j.toLowerCase());c.removeClass("b-attaches__button").addClass("b-attaches__label");f.text(e).attr("title",a);i.call(d.get(0))}function l(){b(this).closest(".b-attaches__label").detach()}function i(){var a= b(".b-attaches__example",b(this)),c=a.clone(!0).removeClass("b-attaches__example").addClass("b-attaches__button");a.after(c)}b.fn.files=function(){0<this.length&&this.each(h);return this}})(jQuery);