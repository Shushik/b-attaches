/**
 * b-attaches script
 *
 * @version 2.0
 * @author  Shushik <silkleopard@yandex.ru>
 * @page    http://github.com/Shushik/b-attaches
 *
 * @requires jQuery 1.6+
 */
;(function(e){function j(){var a=e(this).addClass("b-attaches__input"),b=a.clone(),c=this.onclick();c||(c={});c.attaches_add||(c.attaches_add="Add file");var d=e('<div class="b-attaches"></div>'),f=e('<div class="b-attaches__example"><span class="b-attaches__text">'+c.attaches_add+'</span><span class="b-attaches__remove">\u00d7</span></div>');d.data("params",c);b.bind("change",k);d.delegate(".b-attaches__remove","click",l);f.append(b);a.replaceWith(d.append(f));g.call(d.get(0))}function k(){var a= "",b=e(this).closest(".b-attaches").get(0);if(this.files)for(a in this.files)this.files.hasOwnProperty(a)&&"object"==typeof this.files[a]&&h.call(0==a?this:b,this.files[a]);else h.call(this);g.call(b)}function l(){e(this).closest(".b-attaches__label").detach()}function g(){var a=e(".b-attaches__example",e(this)),b=a.clone(!0).removeClass("b-attaches__example").addClass("b-attaches__button");a.closest(".b-attaches").append(b);return a}function h(a){var b=e(this),c=null,d=null,d="",f=null;b.hasClass("b-attaches__input")? (c=b.closest(".b-attaches__button"),d=c.closest(".b-attaches"),f=d.data("params"),d=b.val(),c.removeClass("b-attaches__button").addClass("b-attaches__label").addClass("b-attaches__label_type_"+d.split(".").pop()),e(".b-attaches__text",c).attr("title",d).text(i(d,f.attaches_crop))):(b=e(this),c=e(".b-attaches__example",b).clone(!0).removeClass("b-attaches__example").addClass("b-attaches__label").addClass("b-attaches__label_type_"+a.name.split(".").pop()),d=b.data("params"),e(".b-attaches__text",c).text(i(a.name, d.attaches_crop)).attr("title",a.name),b.prepend(c))}function i(a,b){var b=b||!1,a=a.split(/\/|\\/).pop(),c=a.length;b&&c>b&&(a=a.substring(0,5)+" \u2026 "+a.substring(c-8));return a}e.fn.files=function(){0<this.length&&this.each(j);return this}})(jQuery);