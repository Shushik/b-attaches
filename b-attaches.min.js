/**
 * b-attaches script
 *
 * @version 2.0
 * @author  Shushik <silkleopard@yandex.ru>
 * @page    http://github.com/Shushik/b-attaches
 *
 * @requires jQuery 1.6+
 */
;(function(d){function j(){var a=d(this),c=a.clone().addClass("b-attaches__input").removeAttr("onclick"),b=this.onclick();b||(b={});b.attaches_add||(b.attaches_add="Add file");var e=d('<div class="b-attaches"></div>'),f=d('<div class="b-attaches__example"><span class="b-attaches__text">'+b.attaches_add+'</span><span class="b-attaches__remove">\u00d7</span></div>');e.data("params",b);e.delegate(".b-attaches__input","change",k);e.delegate(".b-attaches__remove","click",l);f.append(c);e.append(f);a.replaceWith(e); g.call(e.get(0))}function k(){var a="",c=d(this).closest(".b-attaches").get(0);if(this.files)for(a in this.files)this.files.hasOwnProperty(a)&&"object"==typeof this.files[a]&&h.call(0==a?this:c,this.files[a]);else h.call(this);g.call(c)}function l(){d(this).closest(".b-attaches__label").remove()}function g(){var a=d(this),c=d(".b-attaches__example",a),b=c.clone().removeClass("b-attaches__example").addClass("b-attaches__button");a.append(b);return c}function h(a){var a=a||!1,c=d(this),b=null,e=null, e="",f=null;c.hasClass("b-attaches__input")?(b=c.closest(".b-attaches__button"),e=b.closest(".b-attaches"),f=e.data("params"),e=i(c.val(),f.attaches_crop?f.attaches_crop:15),b.removeClass("b-attaches__button").addClass("b-attaches__label").addClass("b-attaches__label_type_"+e.ext),d(".b-attaches__text",b).attr("title",e.full).text(e.crop)):(b=a,a=d(this),c=d(".b-attaches__example",a).clone(),f=a.data("params"),b=i(b.name,f.attaches_crop),c.removeClass("b-attaches__example").addClass("b-attaches__label").addClass("b-attaches__label_type_"+ b.ext),d(".b-attaches__text",c).text(b.crop).attr("title",b.full),a.prepend(c))}function i(a,c){var c=c||!1,b=a.length,e=a.split(/\/|\\/).pop(),d=e;c&&b>c&&(d=d.substring(0,5)+" \u2026 "+d.substring(b-8));return{ext:e.split(".").pop(),full:e,crop:d}}d.fn.files=function(){0<this.length&&this.each(j);return this}})(jQuery);